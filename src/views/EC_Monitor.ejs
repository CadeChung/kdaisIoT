<!DOCTYPE html>
<html lang="en">
<head>
    <title>玉峰園藝監測平台</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 讀取本地端javaScript檔案 -->
    <script src ="/js/jquery-3.6.4.min.js"></script>
    <script src="/js/socket.io.min.js"></script>
    <script src="/js/gauge.min.js"></script>
    <!-- 引用boostrap v5.1.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" 
    rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" 
            crossorigin="anonymous">
    </script>

</head>
<body>
    <body class="bg-secondary">
        <div class="container">

            <nav class="navbar navbar-expand-lg navbar-light bg-transparent text-center d-flex align-items-center vh-10">
                <div class="nav-brand alert-success d-flex align-items-center">
                    <%= message %>
                </div>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
                    <form class= "form-inline my-2 my-lg-0" method="POST" action="/logout">
                        <button type="submit" class="btn btn-primary my-2 my-sm-0">登出</button>
                    </form>
                </div>
            </nav>   

            <div class="row mt-3">
                <div class="col text-center">
                    <h2 class="rounded-pill display-4 bg-warning bg-gradient">玉峰園藝EC觀測平台</h2>
                </div>
            </div>

            <div class="row mt-3">
                <div class="col">
                    <div class="card rounded-pill border border-dark bg-info">
                        <div class="card-body">
                            <div class="row text-center">
                                <h2 id="current-time">現在時間:</h2>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    
            <div class="row mt-3">
                <div class="col-lg-6">
                    <div class="card bg-transparent border border-warning">
                        <div class="card-body text-center">
                            <h3 class="card-title text-center text-warning">EC值儀錶板</h3>
                            <canvas id="Radial-Gauge"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card rounded-3 bg-transparent border border-warning mt-3">
                        <div class="card-body text-center">
                            <canvas id="Linear-gauge"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <script>
        

        $(document).ready(()=>{
            const updateTime =() => {
                let currentTime = new Date()
                let year = currentTime.getFullYear();
                let month = currentTime.getMonth() + 1;
                let day =  currentTime.getDate();
                let hours = currentTime.getHours();
                let minutes = currentTime.getMinutes();
                let seconds = currentTime.getSeconds();

                // 保持兩位數格式
                month = (month < 10 ? "0" : "") + month
                day = (day < 10 ? "0" : "") + day
                hours = (hours < 10 ? "0" : "") + hours;
                minutes = (minutes < 10 ? "0" : "") + minutes;
                seconds = (seconds < 10 ? "0" : "") + seconds;

                let dateString = `現在時間：${year}-${month}-${day} ${hours}:${minutes}:${seconds}`
                
                $('#current-time').text(dateString);
            }
            // 初始化日期和時間
            updateTime();

            //每秒更新日期和時間
            setInterval(updateTime, 1000);
        });

        let gauge = new RadialGauge({
            renderTo: 'Radial-Gauge', // identifier of HTML canvas element or element itself
            width: 300,
            height: 300,
            units: 'μS/cm',
            title: 'EC',
            value: 0,
            minValue: 0,
            maxValue: 2,
            majorTicks: [
                '0','0.2','0.4','0.5','0.6','0.8','1.0','1.2','1.4','1.6','1.8','2'
            ],
            minorTicks: 2,
            strokeTicks: false,
            highlights: [
                { from: 0, to: 0.4, color: 'rgba(0, 183, 255, .7)' },
                { from: 0.4, to: 0.8, color: 'rgba(0, 81, 255, 0.7)' },
                { from: 0.8, to: 1.2, color: 'rgba(30, 255, 0, .25)' },
                { from: 1.2, to: 1.6, color: 'rgba(43, 255, 0, 0.705)' },
                { from: 1.6, to: 2, color: 'rgba(255,0, 0,.9)' }
            ],
            colorPlate: '#222',
            colorMajorTicks: '#f5f5f5',
            colorMinorTicks: '#ddd',
            colorTitle: '#fff',
            colorUnits: '#ccc',
            colorNumbers: '#eee',
            colorNeedleStart: 'rgba(240, 128, 128, 1)',
            colorNeedleEnd: 'rgba(255, 160, 122, .9)',
            valueBox: true,
            animationRule: 'linear'
        }).draw();

        let linearGauge = new LinearGauge({
            renderTo: 'Linear-gauge',
            width: 400,
            height: 300,
            units: "μS/cm",
            title: "EC",
            minValue: 0,
            maxValue: 2,
            majorTicks: [
                0,
                0.2,
                0.4,
                0.6,
                0.8,
                1,
                1.2,
                1.4,
                1.6,
                1.8,
                2
            ],
            minorTicks: 5,
            strokeTicks: true,
            ticksWidth: 15,
            ticksWidthMinor: 7.5,
            highlights: [
                {
                    "from": 0,
                    "to": 1,
                    "color": "rgba(0,0, 255, .3)"
                },
                {
                    "from": 1,
                    "to": 2,
                    "color": "rgba(255, 0, 0, .3)"
                }
            ],
            colorMajorTicks: "#ffe66a",
            colorMinorTicks: "#ffe66a",
            colorTitle: "black",
            colorUnits: "#17171a",
            colorNumbers: "black",
            colorPlate: "#b1abdf",
            colorPlateEnd: "#e92c25d8",
            borderShadowWidth: 0,
            borders: false,
            borderRadius: 10,
            needleType: "arrow",
            needleWidth: 3,
            animationDuration: 1500,
            animationRule: "linear",
            colorNeedle: "#222",
            colorNeedleEnd: "",
            colorBarProgress: "#ffc507",
            colorBar: "#f5f5f5",
            barStroke: 0,
            barWidth: 8,
            barBeginCircle: false
        }).draw();

        const scoket = io().connect();
        scoket.on('Radial-Gauge', (data) => {
            //$('#Radial-Gauge').text(`目前EC值：${data.msg}`);
            console.log('Received message:', data.msg);
            // 設定儀錶板的數值
        	gauge.value = data.msg;
        	linearGauge.value = data.msg;
        });

    </script>
</body>
</html>